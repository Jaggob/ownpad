(()=>{const e=document.documentElement,t=e?.dataset?.ownpadFile,n=e?.dataset?.ownpadSyncUrl,o=Math.max(30,parseInt(e?.dataset?.ownpadSyncInterval||"120",10));if(!t||!n)return;const d=(()=>{if(window.OC){if("function"==typeof OC.getRequestToken)return OC.getRequestToken();if(OC.requestToken)return OC.requestToken}return window.oc_requesttoken?window.oc_requesttoken:document.querySelector('meta[name="requesttoken"]')?.getAttribute("content")||""})();if(!d)return;const r=()=>{const e=new URLSearchParams;return e.set("file",t),e.set("requesttoken",d),e.toString()},a=()=>{fetch(n,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded",requesttoken:d,"X-Requested-With":"XMLHttpRequest"},body:r()}).catch((()=>{}))},i=()=>{if(!navigator.sendBeacon)return void a();const e=new FormData;e.append("file",t),e.append("requesttoken",d),navigator.sendBeacon(n,e)};a();const s=setInterval(a,1e3*o);document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&i()})),window.addEventListener("beforeunload",i),window.addEventListener("unload",i),window.addEventListener("popstate",i),window.addEventListener("pagehide",(()=>{clearInterval(s),i()}));const c=document.getElementById("ownpad_frame");if(c){const e=new MutationObserver((()=>{document.body.contains(c)||(e.disconnect(),i())}));e.observe(document.body,{childList:!0,subtree:!0})}})();
//# sourceMappingURL=ownpad-sync.js.map?v=dff76d5f78e33a6f92aa