{"version":3,"file":"ownpad-sync.js?v=dff76d5f78e33a6f92aa","mappings":"AAAA,MACC,MAAMA,EAAOC,SAASC,gBAChBC,EAAOH,GAAMI,SAASC,WACtBC,EAAUN,GAAMI,SAASG,cACzBC,EAAkBC,KAAKC,IAAI,GAAIC,SAASX,GAAMI,SAASQ,oBAAsB,MAAO,KAC1F,IAAKT,IAASG,EACb,OAGD,MAeMO,EAfkBC,MACvB,GAAIC,OAAOC,GAAI,CACd,GAAkC,mBAAvBA,GAAGF,gBACb,OAAOE,GAAGF,kBAEX,GAAIE,GAAGH,aACN,OAAOG,GAAGH,YAEZ,CACA,OAAIE,OAAOE,gBACHF,OAAOE,gBAERhB,SAASiB,cAAc,8BAA8BC,aAAa,YAAc,EAAE,EAGrEL,GACrB,IAAKD,EACJ,OAGD,MAAMO,EAAgBA,KACrB,MAAMC,EAAO,IAAIC,gBAGjB,OAFAD,EAAKE,IAAI,OAAQpB,GACjBkB,EAAKE,IAAI,eAAgBV,GAClBQ,EAAKG,UAAU,EAGjBC,EAAUA,KACfC,MAAMpB,EAAS,CACdqB,OAAQ,OACRC,YAAa,cACbC,QAAS,CACR,eAAgB,oCAChBC,aAAcjB,EACd,mBAAoB,kBAErBQ,KAAMD,MACJW,OAAM,QAEP,EAGGC,EAAeA,KACpB,IAAKC,UAAUC,WAEd,YADAT,IAGD,MAAMU,EAAO,IAAIC,SACjBD,EAAKE,OAAO,OAAQlC,GACpBgC,EAAKE,OAAO,eAAgBxB,GAC5BoB,UAAUC,WAAW5B,EAAS6B,EAAK,EAGpCV,IACA,MAAMa,EAAQC,YAAYd,EAA2B,IAAlBjB,GAEnCP,SAASuC,iBAAiB,oBAAoB,KACZ,WAA7BvC,SAASwC,iBACZT,GACD,IAGDjB,OAAOyB,iBAAiB,eAAgBR,GACxCjB,OAAOyB,iBAAiB,SAAUR,GAClCjB,OAAOyB,iBAAiB,WAAYR,GACpCjB,OAAOyB,iBAAiB,YAAY,KACnCE,cAAcJ,GACdN,GAAc,IAGf,MAAMW,EAAQ1C,SAAS2C,eAAe,gBACtC,GAAID,EAAO,CACV,MAAME,EAAW,IAAIC,kBAAiB,KAChC7C,SAASoB,KAAK0B,SAASJ,KAC3BE,EAASG,aACThB,IACD,IAEDa,EAASI,QAAQhD,SAASoB,KAAM,CAAE6B,WAAW,EAAMC,SAAS,GAC7D,CACA,EAzFD","sources":["webpack:///ownpad/src/sync.js"],"sourcesContent":["(() => {\n\tconst root = document.documentElement\n\tconst file = root?.dataset?.ownpadFile\n\tconst syncUrl = root?.dataset?.ownpadSyncUrl\n\tconst intervalSeconds = Math.max(30, parseInt(root?.dataset?.ownpadSyncInterval || '120', 10))\n\tif (!file || !syncUrl) {\n\t\treturn\n\t}\n\n\tconst getRequestToken = () => {\n\t\tif (window.OC) {\n\t\t\tif (typeof OC.getRequestToken === 'function') {\n\t\t\t\treturn OC.getRequestToken()\n\t\t\t}\n\t\t\tif (OC.requestToken) {\n\t\t\t\treturn OC.requestToken\n\t\t\t}\n\t\t}\n\t\tif (window.oc_requesttoken) {\n\t\t\treturn window.oc_requesttoken\n\t\t}\n\t\treturn document.querySelector('meta[name=\"requesttoken\"]')?.getAttribute('content') || ''\n\t}\n\n\tconst requestToken = getRequestToken()\n\tif (!requestToken) {\n\t\treturn\n\t}\n\n\tconst buildFormBody = () => {\n\t\tconst body = new URLSearchParams()\n\t\tbody.set('file', file)\n\t\tbody.set('requesttoken', requestToken)\n\t\treturn body.toString()\n\t}\n\n\tconst syncNow = () => {\n\t\tfetch(syncUrl, {\n\t\t\tmethod: 'POST',\n\t\t\tcredentials: 'same-origin',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\trequesttoken: requestToken,\n\t\t\t\t'X-Requested-With': 'XMLHttpRequest',\n\t\t\t},\n\t\t\tbody: buildFormBody(),\n\t\t}).catch(() => {\n\t\t\t// Ignore network errors; next interval will retry.\n\t\t})\n\t}\n\n\tconst syncOnUnload = () => {\n\t\tif (!navigator.sendBeacon) {\n\t\t\tsyncNow()\n\t\t\treturn\n\t\t}\n\t\tconst data = new FormData()\n\t\tdata.append('file', file)\n\t\tdata.append('requesttoken', requestToken)\n\t\tnavigator.sendBeacon(syncUrl, data)\n\t}\n\n\tsyncNow()\n\tconst timer = setInterval(syncNow, intervalSeconds * 1000)\n\n\tdocument.addEventListener('visibilitychange', () => {\n\t\tif (document.visibilityState === 'hidden') {\n\t\t\tsyncOnUnload()\n\t\t}\n\t})\n\n\twindow.addEventListener('beforeunload', syncOnUnload)\n\twindow.addEventListener('unload', syncOnUnload)\n\twindow.addEventListener('popstate', syncOnUnload)\n\twindow.addEventListener('pagehide', () => {\n\t\tclearInterval(timer)\n\t\tsyncOnUnload()\n\t})\n\n\tconst frame = document.getElementById('ownpad_frame')\n\tif (frame) {\n\t\tconst observer = new MutationObserver(() => {\n\t\t\tif (!document.body.contains(frame)) {\n\t\t\t\tobserver.disconnect()\n\t\t\t\tsyncOnUnload()\n\t\t\t}\n\t\t})\n\t\tobserver.observe(document.body, { childList: true, subtree: true })\n\t}\n})()\n"],"names":["root","document","documentElement","file","dataset","ownpadFile","syncUrl","ownpadSyncUrl","intervalSeconds","Math","max","parseInt","ownpadSyncInterval","requestToken","getRequestToken","window","OC","oc_requesttoken","querySelector","getAttribute","buildFormBody","body","URLSearchParams","set","toString","syncNow","fetch","method","credentials","headers","requesttoken","catch","syncOnUnload","navigator","sendBeacon","data","FormData","append","timer","setInterval","addEventListener","visibilityState","clearInterval","frame","getElementById","observer","MutationObserver","contains","disconnect","observe","childList","subtree"],"sourceRoot":""}